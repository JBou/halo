Feature: DNS queries
  
  All packets have been generated using jmdns as a reference

  Scenario: Packet from outgoing DNS query with a question
    Given a DNS query has been created
    And the following questions have been added:
      | serviceName    | recordType | recordClass |
      | foo.bar.local. | ANY        | IN          |
    When the DNS message is encoded
    Then the packet shall contain the following bytes:
      | 0x0  | 0x0  | 0x0  | 0x0  | 0x0  | 0x1  | 0x0  | 0x0  |
      | 0x0  | 0x0  | 0x0  | 0x0  | 0x3  | 0x66 | 0x6f | 0x6f |
      | 0x3  | 0x62 | 0x61 | 0x72 | 0x5  | 0x6c | 0x6f | 0x63 |
      | 0x61 | 0x6c | 0x0  | 0x0  | 0xff | 0x0  | 0x1  |      |

  Scenario: Packet from outgoing DNS query with questions and authorities
    Given a DNS query has been created
    And the following questions have been added:
      | serviceName    | recordType | recordClass |
      | foo.bar.local. | ANY        | IN          |
      | foo.bar.local. | SRV        | ANY         |
    And the following authorities have been added:
      | serviceName          | recordType | recordClass | ttl  | address                                 |
      | some.authority.ipv6. | AAAA       | IN          | PT1H | 2001:0db8:85a3:0000:0000:8a2e:0370:7334 |
      | some.authority.ipv4. | A          | IN          | PT1H | 192.168.154.0                           |
    When the DNS message is encoded
    Then the packet shall contain the following bytes:
      | 0x0  | 0x0  | 0x0  | 0x0  | 0x0  | 0x2  | 0x0  | 0x0  |
      | 0x0  | 0x2  | 0x0  | 0x0  | 0x3  | 0x66 | 0x6f | 0x6f |
      | 0x3  | 0x62 | 0x61 | 0x72 | 0x5  | 0x6c | 0x6f | 0x63 |
      | 0x61 | 0x6c | 0x0  | 0x0  | 0xff | 0x0  | 0x1  | 0xc0 |
      | 0xc  | 0x0  | 0x21 | 0x0  | 0xff | 0x4  | 0x73 | 0x6f |
      | 0x6d | 0x65 | 0x9  | 0x61 | 0x75 | 0x74 | 0x68 | 0x6f |
      | 0x72 | 0x69 | 0x74 | 0x79 | 0x4  | 0x69 | 0x70 | 0x76 |
      | 0x36 | 0x0  | 0x0  | 0x1c | 0x0  | 0x1  | 0x0  | 0x0  |
      | 0xe  | 0x10 | 0x0  | 0x10 | 0x20 | 0x1  | 0xd  | 0xb8 |
      | 0x85 | 0xa3 | 0x0  | 0x0  | 0x0  | 0x0  | 0x8a | 0x2e |
      | 0x3  | 0x70 | 0x73 | 0x34 | 0x4  | 0x73 | 0x6f | 0x6d |
      | 0x65 | 0x9  | 0x61 | 0x75 | 0x74 | 0x68 | 0x6f | 0x72 |
      | 0x69 | 0x74 | 0x79 | 0x4  | 0x69 | 0x70 | 0x76 | 0x34 |
      | 0x0  | 0x0  | 0x1  | 0x0  | 0x1  | 0x0  | 0x0  | 0xe  |
      | 0x10 | 0x0  | 0x4  | 0xc0 | 0xa8 | 0x9a | 0x0  |      |

  Scenario: DNS query with a question from incoming packet
    Given the following packet has been received:
      | 0x0  | 0x5  | 0x0  | 0x0  | 0x0  | 0x1  | 0x0  | 0x0  |
      | 0x0  | 0x0  | 0x0  | 0x0  | 0x3  | 0x66 | 0x6f | 0x6f |
      | 0x3  | 0x62 | 0x61 | 0x72 | 0x5  | 0x6c | 0x6f | 0x63 |
      | 0x61 | 0x6c | 0x0  | 0x0  | 0xff | 0x0  | 0x1  |      |
    When the packet is decoded into a DNS message
    Then a DNS query with "QR_QUERY" flags shall be returned
    And it contains the following questions:
      | serviceName    | recordType | recordClass |
      | foo.bar.local. | ANY        | IN          |
    And it contains no answer
    And it contains no authority
    And it contains no additional

  Scenario: DNS query with questions and authorities from incoming packet
    Given the following packet has been received:
      | 0x0  | 0x0  | 0x0  | 0x0  | 0x0  | 0x2  | 0x0  | 0x0  |
      | 0x0  | 0x2  | 0x0  | 0x0  | 0x3  | 0x66 | 0x6f | 0x6f |
      | 0x3  | 0x62 | 0x61 | 0x72 | 0x5  | 0x6c | 0x6f | 0x63 |
      | 0x61 | 0x6c | 0x0  | 0x0  | 0xff | 0x0  | 0x1  | 0xc0 |
      | 0xc  | 0x0  | 0x21 | 0x0  | 0xff | 0x4  | 0x73 | 0x6f |
      | 0x6d | 0x65 | 0x9  | 0x61 | 0x75 | 0x74 | 0x68 | 0x6f |
      | 0x72 | 0x69 | 0x74 | 0x79 | 0x4  | 0x69 | 0x70 | 0x76 |
      | 0x36 | 0x0  | 0x0  | 0x1c | 0x0  | 0x1  | 0x0  | 0x0  |
      | 0xe  | 0x10 | 0x0  | 0x10 | 0x20 | 0x1  | 0xd  | 0xb8 |
      | 0x85 | 0xa3 | 0x0  | 0x0  | 0x0  | 0x0  | 0x8a | 0x2e |
      | 0x3  | 0x70 | 0x73 | 0x34 | 0x4  | 0x73 | 0x6f | 0x6d |
      | 0x65 | 0x9  | 0x61 | 0x75 | 0x74 | 0x68 | 0x6f | 0x72 |
      | 0x69 | 0x74 | 0x79 | 0x4  | 0x69 | 0x70 | 0x76 | 0x34 |
      | 0x0  | 0x0  | 0x1  | 0x0  | 0x1  | 0x0  | 0x0  | 0xe  |
      | 0x10 | 0x0  | 0x4  | 0xc0 | 0xa8 | 0x9a | 0x0  |      |
    When the packet is decoded into a DNS message
    Then a DNS query with "QR_QUERY" flags shall be returned
    And it contains the following questions:
      | serviceName    | recordType | recordClass |
      | foo.bar.local. | ANY        | IN          |
      | foo.bar.local. | SRV        | ANY         |
    And it contains no answer
    And it contains the following authorities:
      | serviceName          | recordType | recordClass | ttl  | address                                 |
      | some.authority.ipv6. | AAAA       | IN          | PT1H | 2001:0db8:85a3:0000:0000:8a2e:0370:7334 |
      | some.authority.ipv4. | A          | IN          | PT1H | 192.168.154.0                           |
    And it contains no additional
